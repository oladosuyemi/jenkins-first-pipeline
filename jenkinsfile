pipeline {
    agent any

    stages {
        stage('clone repository') {
            steps {
                git:'https://github.com/oladosuyemi/jenkins-first-pipeline.git'
            }
        }
        stage('Adeyemi - Build Docker Image') {
            steps {
                 checkout scm
                 sh 'docker build -t oladosuyemi/adeyemi.py .'
            }
        }

        stage('Adeyemi - Login to Dockerhub') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'dockerhubaccount', passwordVariable: 'docker', usernameVariable: 'oladosuyemi')]) {
                    sh 'docker login -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD'
                }
            }
        }

        stage('Adeyemi - Push image to Dockerhub') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'dockerhubaccount', passwordVariable: 'docker', usernameVariable: 'oladosuyemi')]) {
                    sh 'docker push docker push oladosuyemi/jenkins_2_pipeline:oladosuyemi/adeyemi.py'
                }
            }
        }
    }
}

